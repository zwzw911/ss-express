var uploadDefine=require("../assist/upload_define").uploadDefine,runtimeNodeError=require("../error_define/runtime_node_error").runtime_node_error,mimes=require("../assist/mime").mimes,fs=require("fs"),checkFile=function(a){var b=a.size,c=0;if(uploadDefine.maxAvaliableSpace.define-c-b<0)return uploadDefine.maxAvaliableSpace.error;if(a.originalFilename.length>uploadDefine.fileNameLength.define)return uploadDefine.fileNameLength.error;if(b>uploadDefine.maxFileSize.define)return uploadDefine.maxFileSize.error;var d=a.originalFilename.split(".");if(d.length<2)return uploadDefine.validSuffix.error;var e=a.headers["content-type"].replace(/^(\")|(\"$)/g,""),f=d.pop();return-1===mimes[f].indexOf(e)?uploadDefine.validSuffix.error:!0},checkImgFile=function(a,b){fs.open(a,"r",function(a,c){if(a)return b(a,runtimeNodeError.article.openFileFail);var d=new Buffer(2);fs.read(c,d,0,2,0,function(a,c,d){if(a)return b(a,runtimeNodeError.article.readFileFail);var e=d.toString("hex");switch(e){case"8950":b(null,{rc:0});break;case"ffd8":b(null,{rc:0});break;case"4749":b(null,{rc:0});break;default:b(a,runtimeNodeError.article.invalidateImageType)}})})},sanityImgInText=function(a){regex.check(a,"imgSrc")},eliminateArrayId=function(a){if(a.length>0)for(var b=0;b<a.length;b++)a[b]._id=void 0,a[b].id=void 0},eliminateObjectId=function(a){a._id=void 0,a.id=void 0};exports.assistFunc={checkFile:checkFile,checkImgFile:checkImgFile,sanityImgInText:sanityImgInText,eliminateArrayId:eliminateArrayId,eliminateObjectId:eliminateObjectId};