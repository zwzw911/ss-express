var general=require("../assist/general").general,runtimeNodeError=require("../error_define/runtime_node_error").runtime_node_error,input_validate=require("../error_define/input_validate").input_validate,fs=require("fs"),rightResult={rc:0,msg:null},getPemFile=function(a){for(var b=0,c=a.length;c>b;b++)if(!0===fileExist(a[b]))return a[b]},fileExist=function(a){return fs.existsSync(a)},convertURLSearchString=function(a){for(var b=a.split("+"),c=general.searchTotalKeyLen,d=b.length,e="",f=0;d>f;f++){if(0===f&&b[0].length>c)return e=b[0].substring(0,c),e.trim();if(e.length+b[f].length-f>c)return e.trim();e+=b[f],e+=" "}return e.trim()},getUserInfo=function(a){var b;return 1===a.session.state&&(b={},b.logged=!0,b.userName=a.session.userName),b},generateRandomString=function(a){for(var b,c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",d=c.length,e="",f=0;a>f;f++)b=Math.round(Math.random()*(d-1)),e+=c[b];return e},checkUserState=function(a){return 1!=a.session.state&&2!=a.session.state?runtimeNodeError.general.userNotlogin:rightResult},checkUserId=function(a){return input_validate.user._id.type.define.test(a.session.userId)?rightResult:input_validate.user._id.type.client},checkUserLogin=function(a){return 1===a.session.state?rightResult:runtimeNodeError.general.userNotlogin},checkUserStateNormal=function(a){return 1===a.session.state||2===a.session.state?rightResult:runtimeNodeError.general.userStateWrong},newCheckInterval=function(a){var b,c,d,e=(new Date).getTime();if(!0===a.route.methods.get&&(d="GET"),!0===a.route.methods.post&&(d="POST"),void 0!=a.session.lastPost&&(b=e-a.session.lastPost),void 0!=a.session.lastGet&&(c=e-a.session.lastGet),void 0===d)return runtimeNodeError.general.unknownRequestType;if("POST"===d){if(void 0!==b){if(b<general.sameRequestInterval)return runtimeNodeError.general.intervalWrong;if(b<general.differentRequestInterval)return runtimeNodeError.general.intervalWrong}return a.session.lastPost=e,rightResult}if("GET"===d){if(void 0!==c){if(c<general.sameRequestInterval)return runtimeNodeError.general.intervalWrong;if(c<general.differentRequestInterval)return runtimeNodeError.general.intervalWrong}return a.session.lastGet=e,rightResult}},preCheck=function(a,b){var c=checkUserStateNormal(a);return c.rc>0?c:!0===b&&1!==a.session.state?runtimeNodeError.general.userNotlogin:1===a.session.state&&(c=checkUserId(a),c.rc>0)?c:newCheckInterval(a)};exports.generateFunction={convertURLSearchString:convertURLSearchString,getUserInfo:getUserInfo,generateRandomString:generateRandomString,checkUserState:checkUserState,checkUserId:checkUserId,checkInterval:newCheckInterval,preCheck:preCheck,fileExist:fileExist,getPemFile:getPemFile};