var express=require("express"),router=express.Router(),personalInfoDbOperation=require("./model/personalInfo").personalInfoDbOperation,input_valid=require("./error_define/input_validate").input_validate,runtimeNodeError=require("./error_define/runtime_node_error").runtime_node_error,generalFunc=require("./express_component/generalFunction").generateFunction;router.get("/",function(a,b,c){var d=generalFunc.preCheck(a,!0);if(d.rc>0)return b.json(d);var e=generalFunc.getUserInfo(a);return void 0===e&&b.redirect("login"),b.render("personalInfo",{title:"用户中心",year:(new Date).getFullYear()})}),router.post("/",function(a,b,c){var d=generalFunc.preCheck(a,!0);if(d.rc>0)return b.json(d);var e={};return e.userInfo=generalFunc.getUserInfo(a),b.json({rc:0,msg:e})}),router.post("/getBasicInfo",function(a,b,c){var d=generalFunc.preCheck(a,!0);return d.rc>0?b.json(d):void personalInfoDbOperation.getBasicInfo(a.session.userId,function(a,c){if(c.rc>0)return b.json(c);var d={};return d.name=c.msg.name,d.mobilePhone=c.msg.mobilePhone,b.json({rc:0,msg:d})})}),router.post("/saveBasicInfo",function(a,b,c){var d=generalFunc.preCheck(a,!0);if(d.rc>0)return b.json(d);var e=a.body.userName,f=a.body.mobilePhone;return void 0===e?b.json(input_valid.user.name.require.client):input_valid.user.name.type.define.test(e)?void 0===f||input_valid.user.mobilePhone.type.define.test(f)?void personalInfoDbOperation.saveBasicInfo(a.session.userId,e,f,function(a,c){return b.json(c)}):b.json(input_valid.user.mobilePhone.type.client):b.json(input_valid.user.name.type.client)}),router.post("/savePasswordInfo",function(a,b,c){var d=generalFunc.preCheck(a,!0);if(d.rc>0)return b.json(d);var e=a.body.oldPassword,f=a.body.newPassword,g=a.body.rePassword;return void 0===e?b.json(input_valid.user.oldPassword.require.client):input_valid.user.oldPassword.type.define.test(e)?void 0===f?b.json(input_valid.user.newPassword.require.client):input_valid.user.oldPassword.type.define.test(f)?f!==g?b.json(input_valid.user.rePassword.equal.client):e===f?b.json({rc:0,msg:null}):void personalInfoDbOperation.savePasswordInfo(a.session.userId,e,f,function(a,c){return b.json(c)}):b.json(input_valid.user.newPassword.type.client):b.json(input_valid.user.oldPassword.type.client)}),module.exports=router;