var userModel=require("./db_structure").userModel,errorRecorder=require("../express_component/recorderError").recorderError,input_validate=require("../error_define/input_validate").input_validate,runtimeDbError=require("../error_define/runtime_db_error").runtime_db_error,runtimeNodeError=require("../error_define/runtime_node_error").runtime_node_error,validateDb=require("../error_define/3rd_party_error_define").validateDb,checkUserValidate=function(a,b,c){userModel.find({name:a,password:b},function(a,b){return a?(errorRecorder({rc:a.code,msg:a.errmsg},"login","countUser"),c(a,runtimeDbError.user.findUser)):0===b.length?c(null,runtimeDbError.user.findNoUserWhenLogin):1<b.length?c(null,runtimeDbError.user.findMultiUserWhenLogin):1===b.length?c(null,{rc:0,msg:b[0]}):void 0})},addUser=function(a,b,c,d){var e=new userModel;e.name=a,e.password=b,(null!=c||void 0!=c)&&(e.mobilePhone=c),e.cDate=new Date,validateDb.user(e,"register","addUser",function(b,c){return console.log(b),console.log(c),0<c.result?d(b,c):void userModel.count({name:a},function(a,b){return a?(errorRecorder(a.code,a.errmsg,"register","countUser"),d(a,runtimeDbError.user.count)):b.rc>0?d(null,runtimeNodeError.user.userAlreadyExist):void e.save(function(a,b,c){return a?(errorRecorder({rc:a.code,msg:a.errmsg},"register","saveUser"),d(a,runtimeDbError.user.save)):d(null,{rc:0,msg:b._id})})})})};exports.userDbOperation={checkUserValidate:checkUserValidate,addUser:addUser};