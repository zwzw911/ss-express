var dbStructure=require("./db_structure"),articleModel=dbStructure.articleModel,keyModel=dbStructure.keyModel,userModel=dbStructure.userModel,async=require("async"),generalFunction=require("../express_component/generalFunction").generateFunction,miscellaneous=require("../assist_function/miscellaneous").func,errorRecorder=require("../express_component/recorderError").recorderError,general=require("../assist/general").general,validateDb=require("../error_define/3rd_party_error_define").validateDb,input_validate=require("../error_define/input_validate").input_validate,runtimeDbError=require("../error_define/runtime_db_error").runtime_db_error,runtimeNodeError=require("../error_define/runtime_node_error").runtime_node_error,getLatestArticle=function(a){articleModel.find({},"-_id hashId mDate author title keys pureContent",{sort:{cDate:-1},limit:general.latestArticleNum},function(b,c){if(b)return errorRecorder({rc:b.code,msg:b.errmsg},"main","getLatestArticle-find"),a(b,runtimeDbError.article.find);if(0===c.length)return a(null,{rc:0,msg:void 0});var d=[],e=[{path:"author",model:"users",select:"name mDate"}];async.forEachOf(c,function(b,c,f){b.populate(e,function(b,c){return b?(errorRecorder({rc:b.code,msg:b.errmsg},"main","getLatestArticle-pupolate"),a(b,runtimeDbError.article.populateUser)):(d.push(c.toObject()),void f())})},function(b){return a(null,{rc:0,msg:d})})})};exports.mainDboperation={getLatestArticle:getLatestArticle};