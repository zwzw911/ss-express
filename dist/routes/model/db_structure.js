var uploadDefine=require("../assist/upload_define").uploadDefine,ueditor_config=require("../assist/ueditor_config").ue_config,input_validate=require("../error_define/input_validate").input_validate,micellaneous=require("../assist_function/miscellaneous").func,instMongo=require("./dbConnection"),mongoose=instMongo.mongoose,schemaOptions={autoIndex:!1,bufferCommands:!1,_id:!0,minimize:!0,safe:!0,Strict:!1,validateBeforeSave:!1},toObjectOptions={getters:!0,virtuals:!0,minimize:!0,depopulate:!1,versionKey:!1,retainKeyOrder:!1},userSch=new mongoose.Schema({name:{type:String,unique:!0},password:String,mobilePhone:Number,thumbnail:{type:String,"default":"b10e366431927231a487f08d9d1aae67f1ec18b4.jpg"},cDate:{type:Date,"default":Date()},mDate:{type:Date,"default":Date()},dDate:Date},schemaOptions);userSch.set("toObject",toObjectOptions),userSch.path("name").validate(function(a){return input_validate.user.name.require.define?input_validate.user.name.type.define.test(a):null===a||input_validate.user.name.type.define.test(a)}),userSch.path("password").validate(function(a){return input_validate.user.password.require.define?input_validate.user.password.encryptedPassword.define.test(a):null===a||input_validate.user.password.encryptedPassword.define.test(a)}),userSch.path("mobilePhone").validate(function(a){return input_validate.user.mobilePhone.require.define?input_validate.user.mobilePhone.type.define.test(a):null===a||input_validate.user.mobilePhone.type.define.test(a)}),userSch.path("thumbnail").validate(function(a){return input_validate.user.thumbnail.require.define?input_validate.user.thumbnail.type.define.test(a):null===a||input_validate.user.thumbnail.type.define.test(a)}),userSch.virtual("mDateConv").get(function(){return this.mDate.toLocaleString()});var userModel=mongoose.model("users",userSch),keySch=new mongoose.Schema({key:{type:String,unique:!0},cDate:Date,mDate:{type:Date,"default":Date()},dDate:Date},schemaOptions);keySch.set("toObject",toObjectOptions),keySch.path("key").validate(function(a){return input_validate.key.key.require.define?input_validate.key.key.type.define.test(a):null===a||input_validate.key.key.type.define.test(a)});var keyModel=mongoose.model("keys",keySch),attachmentSch=new mongoose.Schema({hashName:{type:String,unique:!0},name:String,storePath:String,size:Number,cDate:Date,mDate:{type:Date,"default":Date()},dDate:Date},schemaOptions);attachmentSch.set("toObject",toObjectOptions),attachmentSch.path("hashName").validate(function(a){return input_validate.attachment.hashName.require.define?input_validate.attachment.hashName.type.define.test(a):null===a||input_validate.attachment.hashName.type.define.test(a)}),attachmentSch.path("name").validate(function(a){return null!=a&&a.length<input_validate.attachment.name.maxLength.define&&a.length>=input_validate.attachment.name.minLength.define}),attachmentSch.path("storePath").validate(function(a){return null!=a&&a.length<input_validate.attachment.storePath.maxLength.define}),attachmentSch.path("size").validate(function(a){return input_validate.attachment.size.define?null!=a&&a<input_validate.attachment.size.maxLength.define:null===a||a<input_validate.attachment.size.maxLength.define}),attachmentSch.virtual("cDateConv").get(function(){return this.cDate.toLocaleString()});var attachmentModel=mongoose.model("attachments",attachmentSch),innerImageSch=new mongoose.Schema({hashName:{type:String,unique:!0},name:String,storePath:String,size:Number,cDate:Date,mDate:{type:Date,"default":Date()},dDate:Date},schemaOptions);innerImageSch.set("toObject",toObjectOptions),innerImageSch.path("hashName").validate(function(a){return input_validate.innerImage.hashName.require.define?input_validate.innerImage.hashName.type.define.test(a):null===a||input_validate.innerImage.hashName.type.define.test(a)}),innerImageSch.path("name").validate(function(a){return null!=a&&a.length<input_validate.innerImage.name.maxLength.define&&a.length>=input_validate.innerImage.name.minLength.define}),innerImageSch.path("storePath").validate(function(a){return null!=a&&a.length<input_validate.innerImage.storePath.maxLength.define}),innerImageSch.path("size").validate(function(a){return null!=a&&a<=input_validate.innerImage.size.maxLength.define}),innerImageSch.virtual("mDateConv").get(function(){return this.mDate.toLocaleString()});var innerImageModel=mongoose.model("innerImages",innerImageSch),commentSch=new mongoose.Schema({articleId:{type:mongoose.Schema.Types.ObjectId,ref:"articles"},user:{type:mongoose.Schema.Types.ObjectId,ref:"users"},content:String,cDate:Date,mDate:{type:Date,"default":Date()},dDate:Date},schemaOptions);commentSch.set("toObject",toObjectOptions),commentSch.path("articleId").validate(function(a){return input_validate.comment.articleId.require.define?input_validate.comment.articleId.type.define.test(a):null===a||input_validate.comment.articleId.type.define.test(a)}),commentSch.path("user").validate(function(a){return input_validate.comment.user.require.define?input_validate.comment.user.type.define.test(a):null===a||input_validate.comment.user.type.define.test(a)}),commentSch.path("content").validate(function(a){return null==a||a.length<input_validate.comment.content.maxLength.define}),commentSch.virtual("mDateConv").get(function(){return this.mDate.toLocaleString()});var commentModel=mongoose.model("comments",commentSch),articleSch=new mongoose.Schema({hashId:{type:String,unique:!0},title:String,state:{type:String,"enum":["正在编辑","编辑完成"],"default":"正在编辑"},author:{type:mongoose.Schema.Types.ObjectId,ref:"users"},keys:[String],innerImage:[{type:mongoose.Schema.Types.ObjectId,ref:"innerImages"}],attachment:[{type:mongoose.Schema.Types.ObjectId,ref:"attachments"}],pureContent:String,htmlContent:String,comment:[{type:mongoose.Schema.Types.ObjectId,ref:"comments"}],cDate:Date,mDate:{type:Date,"default":Date()},dDate:Date},schemaOptions);articleSch.set("toObject",toObjectOptions),articleSch.path("hashId").validate(function(a){return input_validate.article.hashId.require.define?input_validate.article.hashId.type.define.test(a):null===a||input_validate.article.hashId.type.define.test(a)}),articleSch.path("title").validate(function(a){return null!=a&&a.length>=input_validate.article.title.minLength.define&&a.length<=input_validate.article.title.maxLength.define}),articleSch.path("author").validate(function(a){return input_validate.article.author.require.define?input_validate.article.author.type.define.test(a):null===a||input_validate.article.author.type.define.test(a)}),articleSch.path("keys").validate(function(a){if(a==[]||null===a)return!0;if(a.length<=input_validate.article.keys.maxSize.define)for(var b=0;b<a.length;b++)if(!input_validate.article.keys.type.define.test(a[b]))return!1;return!0}),articleSch.path("innerImage").validate(function(a){if(a==[]||null===a)return!0;if(a.length<=input_validate.article.innerImage.maxSize.define)for(var b=0;b<a.length;b++)if(!input_validate.article.innerImage.type.define.test(a[b]))return!1;return!0}),articleSch.path("attachment").validate(function(a){if(a==[]||null===a)return!0;if(a.length<=input_validate.article.attachment.maxSize.define)for(var b=0;b<a.length;b++)if(!input_validate.article.attachment.type.define.test(a[b]))return!1;return!0}),articleSch.path("pureContent").validate(function(a){return null===a||a.length<input_validate.article.pureContent.maxLength.define}),articleSch.path("htmlContent").validate(function(a){return null===a||a.length<input_validate.article.htmlContent.maxLength.define}),articleSch.virtual("mDateConv").get(function(){return this.mDate.toLocaleString()}),innerImageSch.virtual("cDateConv").get(function(){return this.cDate.toLocaleString()});var articleModel=mongoose.model("articles",articleSch),folderSch=new mongoose.Schema({folderName:{type:String},owner:{type:mongoose.Schema.Types.ObjectId,ref:"users"},parentId:{type:mongoose.Schema.Types.ObjectId,ref:"folders"},level:Number,cDate:Date,mDate:{type:Date,"default":Date()},dDate:Date},schemaOptions);folderSch.set("toObject",toObjectOptions),folderSch.path("folderName").validate(function(a){return null!=a&&input_validate.folder.folderName.type.define.test(a)}),folderSch.path("owner").validate(function(a){return null!=a&&input_validate.folder.owner.type.define.test(a)}),folderSch.path("parentId").validate(function(a){return null==a||input_validate.folder.parentId.type.define.test(a)}),folderSch.path("level").validate(function(a){return null!=a&&input_validate.folder.level.range.define.min<=a&&input_validate.folder.level.range.define.max>=a}),folderSch.virtual("mDateConv").get(function(){return this.mDate.toLocaleString()});var folderModel=mongoose.model("folders",folderSch),keyArticleSch=new mongoose.Schema({articleId:{type:mongoose.Schema.Types.ObjectId,ref:"articles"},keyId:{type:mongoose.Schema.Types.ObjectId,ref:"keys"}},schemaOptions);keyArticleSch.set("toObject",toObjectOptions),keyArticleSch.path("articleId").validate(function(a){return null!=a&&input_validate.keyArticle.articleId.validateError.define.test(a)}),keyArticleSch.path("keyId").validate(function(a){return null!=a&&input_validate.keyArticle.keyId.validateError.define.test(a)});var keyArticleModel=mongoose.model("keyArticles",keyArticleSch),articleFolderSch=new mongoose.Schema({articleId:{type:mongoose.Schema.Types.ObjectId,ref:"articles"},folderId:{type:mongoose.Schema.Types.ObjectId,ref:"personalArticles"},cDate:Date,mDate:{type:Date,"default":Date()},dDate:Date},schemaOptions);articleFolderSch.set("toObject",toObjectOptions),articleFolderSch.path("articleId").validate(function(a){return null!=a&&input_validate.articleFolder.articleId.type.define.test(a)}),articleFolderSch.path("folderId").validate(function(a){return null!=a&&input_validate.articleFolder.folderId.type.define.test(a)});var articleFolderModel=mongoose.model("articleFolders",articleFolderSch),errorSch=new mongoose.Schema({errorCode:Number,errorMsg:String,category:String,subCategory:String,desc:String,priority:String,cDate:Date,mDate:{type:Date,"default":Date()},dDate:Date},schemaOptions);errorSch.set("toObject",toObjectOptions);var errorModel=mongoose.model("errors",errorSch);exports.userModel=userModel,exports.articleModel=articleModel,exports.keyModel=keyModel,exports.attachmentModel=attachmentModel,exports.innerImageModel=innerImageModel,exports.errorModel=errorModel,exports.commentModel=commentModel,exports.folderModel=folderModel,exports.keyArticleModel=keyArticleModel,exports.articleFolderModel=articleFolderModel;