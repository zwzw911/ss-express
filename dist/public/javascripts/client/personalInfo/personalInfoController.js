var commonApp=angular.module("commonApp",[,"inputDefineApp","generalFuncApp"]);commonApp.factory("dataService",["$http",function(a){var b=function(){return a.post("personalInfo",{},{})};return{getUserInfo:b}}]),commonApp.controller("mainController",["dataService","$scope","func","inputDefine","$window","$timeout",function(a,b,c,d,e,f){f(function(){a.getUserInfo().success(function(a,d,e,f){console.log("Timeout executed",Date.now()),a.rc>0?b.errorModal=c.showErrMsg(a.msg):b.userInfo=a.msg.userInfo}).error(function(a,b,c,d){})},2e3);b.quit=function(){var a=c.quit();a.success(function(a,b,c,d){0===a.rc&&(e.location.href="main")}).error(function(a,b,c,d){})},b.search=function(){var a=c.convertInputSearchString(b.searchString,d.search.searchTotalKeyLen.define);return!1===a?!1:void(e.location.href="searchResult?wd="+a)}}]);var app=angular.module("app",["ngRoute","inputDefineApp","generalFuncApp"]);app.factory("dataService",["$http",function(a){var b=function(){return a.post("personalInfo/getBasicInfo",{},{})},c=function(b,c){return a.post("personalInfo/saveBasicInfo",{userName:b,mobilePhone:c},{})},d=function(b,c,d){return a.post("personalInfo/savePasswordInfo",{oldPassword:b,newPassword:c,rePassword:d},{})};return{getBasicInfo:b,saveBasicInfo:c,savePasswordInfo:d}}]),app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/personalInfo/basicInfo",{templateUrl:"basicInfo",controller:"basicInfoController"}).when("/personalInfo/passwordInfo",{templateUrl:"passwordInfo",controller:"passwordInfoController"}).otherwise({redirectTo:"/personalInfo/basicInfo"}),b.html5Mode(!0)}]),app.controller("menuController",["$scope",function(a){a.menuItem={userInfo:{active:!0},changePassword:{active:!1}},a.clickMenu=function(b){switch(b){case"userInfo":a.menuItem.userInfo.active=!0,a.menuItem.changePassword.active=!1;break;case"changePassword":a.menuItem.userInfo.active=!1,a.menuItem.changePassword.active=!0}}}]),app.controller("basicInfoController",["$scope","dataService","$window","inputDefine","func",function(a,b,c,d,e){a.globalVar={edit:!1,allValidateOK:!0},a.input=[{labelName:"用户名",inputName:"name",curValue:"",oldValue:void 0,validateOK:!0},{labelName:"手机",inputName:"mobilePhone",curValue:"",oldValue:void 0,validateOK:!0}];var f=b.getBasicInfo();setTimeout(f.success(function(b,d,f,g){b.rc>0?(a.errorModal=e.showErrMsg(b.msg),40001==b.rc&&setTimeout(c.location.href="login",3e3)):(a.input[0].curValue=b.msg.name,a.input[1].curValue=b.msg.mobilePhone)}).error(function(a,b,c,d){}),3e3),a.saveBasicInfo=function(){a.globalVar.allValidateOK=!0;for(var c=0;c<a.input.length;c++)a.globalVar.allValidateOK=a.globalVar.allValidateOK&&a.input[c].validateOK;if(!a.globalVar.allValidateOK)return!1;for(var d=!0,c=0;c<a.input.length;c++)if(a.input[c].curValue!==a.input[c].oldValue){d=!1;break}if(d)return a.globalVar.edit=!1,!0;var f=a.input[0].curValue,g=a.input[1].curValue,h=b.saveBasicInfo(f,g);h.success(function(b,c,d,f){b.rc>0?a.errorModal=e.showErrMsg(b.msg):a.globalVar.edit=!1}).error(function(a,b,c,d){})},a.editBasicInfo=function(){for(var b=0;b<a.input.length;b++)a.input[b].oldValue=a.input[b].curValue;a.globalVar.edit=!0},a.cancelBasicInfo=function(){for(var b=0;b<a.input.length;b++)a.input[b].curValue=a.input[b].oldValue,a.input[b].errorMsg="",a.input[b].validateOK=!0;a.globalVar.edit=!1},a.checkInput=function(b){var c=a.input[b].inputName,e=a.input[b];return!d.user[c].require.define||""!==e.curValue&&void 0!==e.curValue&&null!==e.curValue?d.user[c].type.define.test(e.curValue)?(e.errorMsg="",void(e.validateOK=!0)):(e.errorMsg=d.user[c].type.msg,e.validateOK=!1,!1):(e.errorMsg=d.user[c].require.msg,e.validateOK=!1,!1)}}]),app.controller("passwordInfoController",["$scope","dataService","inputDefine","func",function(a,b,c,d){var e=function(){for(var b=0;b<a.input.length;b++)a.input[b].curValue="",a.input[b].errorMsg="",a.input[b].validateOK=!0;a.globalVar.allValidateOK=!1};a.globalVar={allValidateOK:!1},a.input=[{labelName:"旧密码",inputName:"oldPassword",curValue:"",errorMsg:"",validateOK:!0},{labelName:"新密码",inputName:"newPassword",curValue:"",errorMsg:"",validateOK:!0},{labelName:"重复密码",inputName:"rePassword",curValue:"",errorMsg:"",validateOK:!0}],a.checkInput=function(b){var d=a.input[b];if(c.user.password.require.define&&(""===d.curValue||void 0===d.curValue||null===d.curValue))return d.errorMsg=c.user.password.require.msg,d.validateOK=!1,!1;if(!c.user.password.type.define.test(d.curValue))return d.errorMsg=c.user.password.type.msg,d.validateOK=!1,!1;if(2===b){var e=a.input[1];if(d.curValue.toString()!==e.curValue.toString())return d.errorMsg=c.user.rePassword.equal.msg,d.validateOK=!1,!1}d.errorMsg="",d.validateOK=!0;for(var f=0;f<a.input.length;f++){var g=!0,d=a.input[f];g=g&&d.validateOK}return a.globalVar.allValidateOK=g,!0},a.savePasswordInfo=function(){if(!a.globalVar.allValidateOK)return!1;var f=a.input[1],g=a.input[2],h=a.input[0].curValue,i=a.input[1].curValue,j=a.input[2].curValue;if(h===i&&(""!==h||void 0!==h||null!==h))return f.errorMsg="新旧密码不能一样",f.validateOK=!1,!1;if(j!==i&&(""!==i||void 0!==i||null!==i))return g.errorMsg=c.user.rePassword.equal.msg,g.validateOK=!1,!1;var k=b.savePasswordInfo(h,i,j);k.success(function(b,c,f,g){0===b.rc?(e(),a.errorModal=d.showInfoMsg("密码更改成功")):a.errorModal=d.showErrMsg(b.msg)}).error(function(a,b,c,d){})},a.cancelPasswordInfo=function(){e()}}]),angular.bootstrap(document.getElementById("route"),["app"]);